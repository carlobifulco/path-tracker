// Generated by CoffeeScript 1.3.3
(function() {
  var _this = this;

  $(document).ready(function() {
    var check_login, check_result, new_account, redirect_to_main, set_new_user;
    redirect_to_main = function() {
      return window.location.href = "/";
    };
    check_result = function(r) {
      if (r.ok === false || r.ok === "false") {
        return $("#bad_login").html("BAD LOGIN");
      } else {
        return redirect_to_main();
      }
    };
    check_login = function() {
      var data, password, url, username;
      username = $("#login_username").val();
      password = $("#login_password").val();
      data = {
        password: password,
        username: username
      };
      url = "/login";
      return $.post(url, data).done(function(e) {
        e = JSON.parse(e);
        console.log("r=" + e);
        if (e === true) {
          console.log("TRUE");
          redirect_to_main();
        }
        if (e === false) {
          return alert("Invalid Login.  Try Again");
        }
      });
    };
    set_new_user = function(user, password) {
      localStorage.user = user;
      localStorage.password = password;
      return redirect_to_main();
    };
    new_account = function() {
      var p, password, url, user;
      console.log("create account ");
      user = $("#account_username").val();
      password = $("#account_password").val();
      url = "/create_user/" + user;
      url = encodeURI(url);
      p = $.post(url, {
        "password": password,
        "type": "json"
      });
      p.done(function() {
        return set_new_user(user, password);
      });
      return p.error(function() {
        return $("#bad_login").html("Pre-existing username; select a different username");
      });
    };
    window.check_login = check_login;
    window.new_account = new_account;
    return $("#login_button").click(check_login);
  });

}).call(this);
